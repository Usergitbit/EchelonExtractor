!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,(function(t){return e[t]}).bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="ay9R")}({ay9R:function(e,t,n){"use strict";n.r(t);var o=function(e){return e[e.Load=0]="Load",e[e.ExtractEchelons=1]="ExtractEchelons",e[e.CombineEchelons=2]="CombineEchelons",e}({}),r=function(e){return e[e.LoadCompleted=0]="LoadCompleted",e[e.EchelonExtracted=1]="EchelonExtracted",e[e.EchelonsCombined=2]="EchelonsCombined",e[e.Error=3]="Error",e}({});function c(e,t){u({information:i(r.Error,t.information.requestId,t.information.processingUnitId,`There was an error processing the request. Message:${e.message}. Line number ${e.lineno} Column number: ${e.colno}`)})}function a(e){const t=new ImageData(new Uint8ClampedArray(e.imageArrayBuffer),e.width,e.height),n=cv.matFromImageData(t),o=cv.matFromImageData(t);cv.cvtColor(o,o,cv.COLOR_RGBA2GRAY,0),cv.threshold(o,o,50,250,cv.THRESH_BINARY);const r=new cv.MatVector,c=new cv.Mat;cv.findContours(o,r,c,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE);const a=new Array;for(let i=0;i<r.size();i++){const e=r.get(i),t=cv.boundingRect(e),o=t.width/t.height;if(o>=6.1&&o<=6.5&&t.width>100){const e=n.roi(t),o=d(e);a.push(o),e.delete()}e.delete()}return c.delete(),r.delete(),o.delete(),n.delete(),a.reverse()}function i(e,t,n,o){return{requestId:t,responseType:e,message:o,processingUnitId:n}}function s(e){const t=new Array;return e.forEach(e=>{t.push({imageArrayBuffer:e.data.buffer,height:e.height,width:e.width})}),{images:t}}function u(e){if(e.content){const t=e.content.images.map(e=>e.imageArrayBuffer);postMessage(e,t)}else postMessage(e)}function l(e,t){return"opencv_js.wasm"===e?t+"assets/opencv/wasm/4.4/"+e:t+e}function d(e){const t=new cv.Mat,n=e.type()%8,o=n<=cv.CV_8S?1:n<=cv.CV_32S?1/256:255,r=n===cv.CV_8S||n===cv.CV_16S?128:0;switch(e.convertTo(t,cv.CV_8U,o,r),t.type()){case cv.CV_8UC1:cv.cvtColor(t,t,cv.COLOR_GRAY2RGBA);break;case cv.CV_8UC3:cv.cvtColor(t,t,cv.COLOR_RGB2RGBA);break;case cv.CV_8UC4:break;default:throw new Error("Bad number of channels (Source image must have 1, 3 or 4 channels)")}const c=new ImageData(new Uint8ClampedArray(t.data),t.cols,t.rows);return t.delete(),c}addEventListener("message",e=>{const t=e.data;switch(t.information.requestType){case o.Load:try{!function(e){var t,n,o;t=this,o=function*(){console.log("Recieved load request"),self.Module={wasmBinaryFile:"assets/opencv/wasm/4.4/opencv_js.wasm",usingWasm:!0,locateFile:l,onRuntimeInitialized:()=>{u({information:{responseType:r.LoadCompleted,requestId:e.information.requestId,processingUnitId:e.information.processingUnitId}})}},self.importScripts("./assets/opencv/wasm/4.4/opencv.js"),cv=yield cv()},new((n=void 0)||(n=Promise))(function(e,r){function c(e){try{i(o.next(e))}catch(t){r(t)}}function a(e){try{i(o.throw(e))}catch(t){r(t)}}function i(t){var o;t.done?e(t.value):(o=t.value,o instanceof n?o:new n(function(e){e(o)})).then(c,a)}i((o=o.apply(t,[])).next())})}(t)}catch(n){c(n,t)}break;case o.ExtractEchelons:try{!function(e){if(!e.content)throw new Error("Image content must not be null or undefined");const t=e.content.images,n=new Array;for(const o of t)a(o).forEach(e=>{n.push(e)});u({information:i(r.EchelonExtracted,e.information.requestId,e.information.processingUnitId),content:s(n)})}(t)}catch(n){c(n,t)}break;case o.CombineEchelons:try{!function(e){if(!e.content)throw new Error("Image content must not be null or undefined");const t=function(e){let t=e.reduce((e,t)=>e+t.height,0);const n=e.reduce((e,t)=>e>t.width?e:t.width,0);let o=cv.CV_8UC4;const r=cv.Mat.ones(t,n,o);let c=0,a=e[0].height;for(let s=0;s<e.length;s++){const n=e[s],i=new ImageData(new Uint8ClampedArray(n.imageArrayBuffer),n.width,n.height),u=cv.matFromImageData(i);t+=u.rows,o=u.type(),u.copyTo(r.rowRange(c,a).colRange(0,u.cols)),s!==e.length-1&&(c=a,a+=e[s+1].height),u.delete()}const i=d(r);return r.delete(),i}(e.content.images);u({information:i(r.EchelonsCombined,e.information.requestId,e.information.processingUnitId),content:s(new Array(t))})}(t)}catch(n){c(n,t)}break;default:throw new Error(`Request type ${t.information.requestType} not implemented.`)}})}});